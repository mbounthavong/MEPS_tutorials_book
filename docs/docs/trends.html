<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 5 Simple trend analysis with linear models | MEPS tutorials</title>
  <meta name="description" content="This is a collection of MEPS tutorials." />
  <meta name="generator" content="bookdown 0.30 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 5 Simple trend analysis with linear models | MEPS tutorials" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="This is a collection of MEPS tutorials." />
  <meta name="github-repo" content="mbounthavong/MEPS_tutorials_book" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 5 Simple trend analysis with linear models | MEPS tutorials" />
  
  <meta name="twitter:description" content="This is a collection of MEPS tutorials." />
  

<meta name="author" content="Mark Bounthavong" />


<meta name="date" content="2024-01-21" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="clnk.html"/>
<link rel="next" href="itsa.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">MEPS Tutorials Collection</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>About</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#book-link"><i class="fa fa-check"></i>Book link</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#table-of-contents"><i class="fa fa-check"></i>Table of contents</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> Loading MEPS data into R</a>
<ul>
<li class="chapter" data-level="1.1" data-path="intro.html"><a href="intro.html#introduction"><i class="fa fa-check"></i><b>1.1</b> Introduction</a></li>
<li class="chapter" data-level="1.2" data-path="intro.html"><a href="intro.html#meps-data"><i class="fa fa-check"></i><b>1.2</b> MEPS Data</a></li>
<li class="chapter" data-level="1.3" data-path="intro.html"><a href="intro.html#load-meps-data-into-r"><i class="fa fa-check"></i><b>1.3</b> Load MEPS data into R</a></li>
<li class="chapter" data-level="1.4" data-path="intro.html"><a href="intro.html#conclusions"><i class="fa fa-check"></i><b>1.4</b> Conclusions</a></li>
<li class="chapter" data-level="1.5" data-path="intro.html"><a href="intro.html#acknowledgements"><i class="fa fa-check"></i><b>1.5</b> Acknowledgements</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="merging.html"><a href="merging.html"><i class="fa fa-check"></i><b>2</b> Merging files</a>
<ul>
<li class="chapter" data-level="2.1" data-path="merging.html"><a href="merging.html#introduction-1"><i class="fa fa-check"></i><b>2.1</b> Introduction</a></li>
<li class="chapter" data-level="2.2" data-path="merging.html"><a href="merging.html#load-meps-data"><i class="fa fa-check"></i><b>2.2</b> Load MEPS data</a></li>
<li class="chapter" data-level="2.3" data-path="merging.html"><a href="merging.html#merge-meps-data"><i class="fa fa-check"></i><b>2.3</b> Merge MEPS data</a></li>
<li class="chapter" data-level="2.4" data-path="merging.html"><a href="merging.html#reduce-dataframe-to-a-few-variables"><i class="fa fa-check"></i><b>2.4</b> Reduce dataframe to a few variables</a></li>
<li class="chapter" data-level="2.5" data-path="merging.html"><a href="merging.html#add-an-indicator-for-a-specific-icd10-diagnostic-code"><i class="fa fa-check"></i><b>2.5</b> Add an indicator for a specific ICD10 diagnostic code</a></li>
<li class="chapter" data-level="2.6" data-path="merging.html"><a href="merging.html#collapse-dataframe-to-a-single-unique-patient"><i class="fa fa-check"></i><b>2.6</b> Collapse dataframe to a single unique patient</a></li>
<li class="chapter" data-level="2.7" data-path="merging.html"><a href="merging.html#conclusions-1"><i class="fa fa-check"></i><b>2.7</b> Conclusions</a></li>
<li class="chapter" data-level="2.8" data-path="merging.html"><a href="merging.html#acknowledgements-1"><i class="fa fa-check"></i><b>2.8</b> Acknowledgements</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="weights.html"><a href="weights.html"><i class="fa fa-check"></i><b>3</b> Applying weights</a>
<ul>
<li class="chapter" data-level="3.1" data-path="weights.html"><a href="weights.html#introduction-2"><i class="fa fa-check"></i><b>3.1</b> Introduction</a></li>
<li class="chapter" data-level="3.2" data-path="weights.html"><a href="weights.html#types-of-weights"><i class="fa fa-check"></i><b>3.2</b> Types of weights</a></li>
<li class="chapter" data-level="3.3" data-path="weights.html"><a href="weights.html#loading-the-data"><i class="fa fa-check"></i><b>3.3</b> Loading the data</a></li>
<li class="chapter" data-level="3.4" data-path="weights.html"><a href="weights.html#perform-descriptive-analysis"><i class="fa fa-check"></i><b>3.4</b> Perform descriptive analysis</a></li>
<li class="chapter" data-level="3.5" data-path="weights.html"><a href="weights.html#conclusions-2"><i class="fa fa-check"></i><b>3.5</b> Conclusions</a></li>
<li class="chapter" data-level="3.6" data-path="weights.html"><a href="weights.html#acknowledgements-2"><i class="fa fa-check"></i><b>3.6</b> Acknowledgements</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="clnk.html"><a href="clnk.html"><i class="fa fa-check"></i><b>4</b> Using condition-event link (<code>CLNK</code>) file</a>
<ul>
<li class="chapter" data-level="4.1" data-path="clnk.html"><a href="clnk.html#introduction-3"><i class="fa fa-check"></i><b>4.1</b> Introduction</a></li>
<li class="chapter" data-level="4.2" data-path="clnk.html"><a href="clnk.html#motivating-example---migraine-specific-expenditures"><i class="fa fa-check"></i><b>4.2</b> Motivating example - Migraine-specific expenditures</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="clnk.html"><a href="clnk.html#part-1---setup"><i class="fa fa-check"></i><b>4.2.1</b> Part 1 - Setup</a></li>
<li class="chapter" data-level="4.2.2" data-path="clnk.html"><a href="clnk.html#part-2---migraine-specific-office-based-expenditures"><i class="fa fa-check"></i><b>4.2.2</b> Part 2 - Migraine-specific office-based expenditures</a></li>
<li class="chapter" data-level="4.2.3" data-path="clnk.html"><a href="clnk.html#part-3---migraine-specific-inpatient-expenditures"><i class="fa fa-check"></i><b>4.2.3</b> Part 3 - Migraine-specific inpatient expenditures</a></li>
<li class="chapter" data-level="4.2.4" data-path="clnk.html"><a href="clnk.html#part-4---combine-office-based-and-inpatient-expenditure-files"><i class="fa fa-check"></i><b>4.2.4</b> Part 4 - Combine office-based and inpatient expenditure files</a></li>
<li class="chapter" data-level="4.2.5" data-path="clnk.html"><a href="clnk.html#part-5---descriptive-analysis-using-survey-weights"><i class="fa fa-check"></i><b>4.2.5</b> Part 5 - Descriptive analysis using survey weights</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="clnk.html"><a href="clnk.html#conclusions-3"><i class="fa fa-check"></i><b>4.3</b> Conclusions</a></li>
<li class="chapter" data-level="4.4" data-path="clnk.html"><a href="clnk.html#acknowledgements-3"><i class="fa fa-check"></i><b>4.4</b> Acknowledgements</a></li>
<li class="chapter" data-level="4.5" data-path="clnk.html"><a href="clnk.html#work-in-progress"><i class="fa fa-check"></i><b>4.5</b> Work in progress</a></li>
<li class="chapter" data-level="4.6" data-path="clnk.html"><a href="clnk.html#disclaimers"><i class="fa fa-check"></i><b>4.6</b> Disclaimers</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="trends.html"><a href="trends.html"><i class="fa fa-check"></i><b>5</b> Simple trend analysis with linear models</a>
<ul>
<li class="chapter" data-level="5.1" data-path="trends.html"><a href="trends.html#introduction-4"><i class="fa fa-check"></i><b>5.1</b> Introduction</a></li>
<li class="chapter" data-level="5.2" data-path="trends.html"><a href="trends.html#motivating-example"><i class="fa fa-check"></i><b>5.2</b> Motivating example</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="trends.html"><a href="trends.html#loading-the-libraries"><i class="fa fa-check"></i><b>5.2.1</b> Loading the libraries</a></li>
<li class="chapter" data-level="5.2.2" data-path="trends.html"><a href="trends.html#loading-data-into-the-r-environment"><i class="fa fa-check"></i><b>5.2.2</b> Loading data into the R environment</a></li>
<li class="chapter" data-level="5.2.3" data-path="trends.html"><a href="trends.html#download-the-linkage-file"><i class="fa fa-check"></i><b>5.2.3</b> Download the linkage file</a></li>
<li class="chapter" data-level="5.2.4" data-path="trends.html"><a href="trends.html#creating-the-pooled-data-file"><i class="fa fa-check"></i><b>5.2.4</b> Creating the pooled data file</a></li>
<li class="chapter" data-level="5.2.5" data-path="trends.html"><a href="trends.html#merging-with-pooled-survey-primary-sampling-strata-and-unit"><i class="fa fa-check"></i><b>5.2.5</b> Merging with pooled survey primary sampling strata and unit</a></li>
<li class="chapter" data-level="5.2.6" data-path="trends.html"><a href="trends.html#create-factor-variables"><i class="fa fa-check"></i><b>5.2.6</b> Create factor variables</a></li>
<li class="chapter" data-level="5.2.7" data-path="trends.html"><a href="trends.html#set-the-survey-options"><i class="fa fa-check"></i><b>5.2.7</b> Set the survey options</a></li>
<li class="chapter" data-level="5.2.8" data-path="trends.html"><a href="trends.html#trend-analysis---plot-the-total-healthcare-costs-by-sex-across-time"><i class="fa fa-check"></i><b>5.2.8</b> Trend analysis - Plot the total healthcare costs by sex across time</a></li>
<li class="chapter" data-level="5.2.9" data-path="trends.html"><a href="trends.html#regression-model"><i class="fa fa-check"></i><b>5.2.9</b> Regression model</a></li>
<li class="chapter" data-level="5.2.10" data-path="trends.html"><a href="trends.html#average-marginal-effects-between-males-and-females-at-each-year"><i class="fa fa-check"></i><b>5.2.10</b> Average marginal effects between males and females at each year</a></li>
<li class="chapter" data-level="5.2.11" data-path="trends.html"><a href="trends.html#average-marginal-effects-between-years-for-males-and-females"><i class="fa fa-check"></i><b>5.2.11</b> Average marginal effects between years for males and females</a></li>
<li class="chapter" data-level="5.2.12" data-path="trends.html"><a href="trends.html#plot-the-average-marginal-effects"><i class="fa fa-check"></i><b>5.2.12</b> Plot the average marginal effects</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="trends.html"><a href="trends.html#conclusions-4"><i class="fa fa-check"></i><b>5.3</b> Conclusions</a></li>
<li class="chapter" data-level="5.4" data-path="trends.html"><a href="trends.html#acknowledgements-4"><i class="fa fa-check"></i><b>5.4</b> Acknowledgements</a></li>
<li class="chapter" data-level="5.5" data-path="trends.html"><a href="trends.html#work-in-progress-1"><i class="fa fa-check"></i><b>5.5</b> Work in progress</a></li>
<li class="chapter" data-level="5.6" data-path="trends.html"><a href="trends.html#disclaimers-1"><i class="fa fa-check"></i><b>5.6</b> Disclaimers</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="itsa.html"><a href="itsa.html"><i class="fa fa-check"></i><b>6</b> Interrupted time series analysis (ITSA) with R: A short tutorial</a>
<ul>
<li class="chapter" data-level="6.1" data-path="itsa.html"><a href="itsa.html#introduction-5"><i class="fa fa-check"></i><b>6.1</b> Introduction</a></li>
<li class="chapter" data-level="6.2" data-path="itsa.html"><a href="itsa.html#motivating-example---total-healthcare-costs-from-2016-to-2021-by-sex"><i class="fa fa-check"></i><b>6.2</b> Motivating example - Total Healthcare Costs from 2016 to 2021 by sex</a></li>
<li class="chapter" data-level="6.3" data-path="itsa.html"><a href="itsa.html#interrupted-time-series-analysis-design"><i class="fa fa-check"></i><b>6.3</b> Interrupted Time Series Analysis Design</a></li>
<li class="chapter" data-level="6.4" data-path="itsa.html"><a href="itsa.html#set-up-the-survey-options"><i class="fa fa-check"></i><b>6.4</b> Set up the survey options</a></li>
<li class="chapter" data-level="6.5" data-path="itsa.html"><a href="itsa.html#descriptive-analysis"><i class="fa fa-check"></i><b>6.5</b> Descriptive analysis</a></li>
<li class="chapter" data-level="6.6" data-path="itsa.html"><a href="itsa.html#linear-regression-model"><i class="fa fa-check"></i><b>6.6</b> Linear regression model</a></li>
<li class="chapter" data-level="6.7" data-path="itsa.html"><a href="itsa.html#plot"><i class="fa fa-check"></i><b>6.7</b> Plot</a></li>
<li class="chapter" data-level="6.8" data-path="itsa.html"><a href="itsa.html#parallel-trends-assumption"><i class="fa fa-check"></i><b>6.8</b> Parallel trends assumption</a></li>
<li class="chapter" data-level="6.9" data-path="itsa.html"><a href="itsa.html#additional-estimations"><i class="fa fa-check"></i><b>6.9</b> Additional estimations</a></li>
<li class="chapter" data-level="6.10" data-path="itsa.html"><a href="itsa.html#issues-with-the-current-model"><i class="fa fa-check"></i><b>6.10</b> Issues with the current model</a></li>
<li class="chapter" data-level="6.11" data-path="itsa.html"><a href="itsa.html#workaround-using-a-linear-spline-model"><i class="fa fa-check"></i><b>6.11</b> Workaround using a linear spline model</a></li>
<li class="chapter" data-level="6.12" data-path="itsa.html"><a href="itsa.html#differences-in-level-immediately-after-implementation-of-the-intervention"><i class="fa fa-check"></i><b>6.12</b> Differences in level immediately after implementation of the intervention</a></li>
<li class="chapter" data-level="6.13" data-path="itsa.html"><a href="itsa.html#difference-in-differences-estimation"><i class="fa fa-check"></i><b>6.13</b> Difference-in-differences estimation</a></li>
<li class="chapter" data-level="6.14" data-path="itsa.html"><a href="itsa.html#putting-it-all-together"><i class="fa fa-check"></i><b>6.14</b> Putting it all together</a></li>
<li class="chapter" data-level="6.15" data-path="itsa.html"><a href="itsa.html#conclusions-5"><i class="fa fa-check"></i><b>6.15</b> Conclusions</a></li>
<li class="chapter" data-level="6.16" data-path="itsa.html"><a href="itsa.html#acknowledgements-5"><i class="fa fa-check"></i><b>6.16</b> Acknowledgements</a></li>
<li class="chapter" data-level="6.17" data-path="itsa.html"><a href="itsa.html#work-in-progress-2"><i class="fa fa-check"></i><b>6.17</b> Work in progress</a></li>
<li class="chapter" data-level="6.18" data-path="itsa.html"><a href="itsa.html#disclaimers-2"><i class="fa fa-check"></i><b>6.18</b> Disclaimers</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="notes.html"><a href="notes.html"><i class="fa fa-check"></i><b>7</b> Helpful Notes</a>
<ul>
<li class="chapter" data-level="7.1" data-path="notes.html"><a href="notes.html#introduction-6"><i class="fa fa-check"></i><b>7.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="notes.html"><a href="notes.html#meps-file-names"><i class="fa fa-check"></i><b>7.1.1</b> 1. MEPS file names</a></li>
<li class="chapter" data-level="7.1.2" data-path="notes.html"><a href="notes.html#expenditure-categories"><i class="fa fa-check"></i><b>7.1.2</b> 2. Expenditure categories</a></li>
<li class="chapter" data-level="7.1.3" data-path="notes.html"><a href="notes.html#sources-of-payments"><i class="fa fa-check"></i><b>7.1.3</b> 3. Sources of payments</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="notes.html"><a href="notes.html#references"><i class="fa fa-check"></i><b>7.2</b> References</a></li>
<li class="chapter" data-level="7.3" data-path="notes.html"><a href="notes.html#disclaimer"><i class="fa fa-check"></i><b>7.3</b> Disclaimer</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">MEPS tutorials</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="trends" class="section level1 hasAnchor" number="5">
<h1><span class="header-section-number">Chapter 5</span> Simple trend analysis with linear models<a href="trends.html#trends" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="introduction-4" class="section level2 hasAnchor" number="5.1">
<h2><span class="header-section-number">5.1</span> Introduction<a href="trends.html#introduction-4" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Analyzing trends can be a tricky matter. You have to consider many things such as the autoregressive correlation between values across the time interval or the seasonal effects that occur and are unrelated to the risk factor. All these issues contribute to the difficulty and challenge of trend analysis. However, there are simple ways to perform rudimentary trend analysis with linear models that might be useful for most stakeholders.</p>
<p>Linear models are useful because they are easy to interpret. There is no re-transformation needed, and the outputs are interpreted in terms of real units. Non-linear models may require re-transformation or some kind of adjustment to get the <span class="math inline">\(\beta\)</span> coefficients to be interpretable in real units.</p>
<p>Although there are a lot of different models that take into consideration the strength of the correlation between values across time (e.g., generalized estimating equation models) or the random slope and intercepts of subjects and groups, we will use the linear effects model to interpret the trends of healthcare expenditure of a representative sample of the US non-institutionalized patients.</p>
</div>
<div id="motivating-example" class="section level2 hasAnchor" number="5.2">
<h2><span class="header-section-number">5.2</span> Motivating example<a href="trends.html#motivating-example" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We will use data from the <a href="https://meps.ahrq.gov/mepsweb/">Agency for Healthcare Research and Quality (AHRQ) Medical Expenditure Panel Survey (MEPS)</a> data from 2016 to 2021. We will use R to perform the simple trend analysis.</p>
<div id="loading-the-libraries" class="section level3 hasAnchor" number="5.2.1">
<h3><span class="header-section-number">5.2.1</span> Loading the libraries<a href="trends.html#loading-the-libraries" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>There are several libraries that we’ll need to install and then load.</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="trends.html#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="do">### step 1a: Load the MEPS package</span></span>
<span id="cb85-2"><a href="trends.html#cb85-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;MEPS&quot;</span>) <span class="do">## You need to load the library every time you restart R</span></span>
<span id="cb85-3"><a href="trends.html#cb85-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-4"><a href="trends.html#cb85-4" aria-hidden="true" tabindex="-1"></a><span class="do">### Step 1b: Load the other libraries</span></span>
<span id="cb85-5"><a href="trends.html#cb85-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;survey&quot;</span>)</span>
<span id="cb85-6"><a href="trends.html#cb85-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;foreign&quot;</span>)</span>
<span id="cb85-7"><a href="trends.html#cb85-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;dplyr&quot;</span>)</span>
<span id="cb85-8"><a href="trends.html#cb85-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;ggplot2&quot;</span>)</span>
<span id="cb85-9"><a href="trends.html#cb85-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;questionr&quot;</span>) <span class="co"># remotes::install_github(&quot;juba/questionr&quot;)</span></span>
<span id="cb85-10"><a href="trends.html#cb85-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;lspline&quot;</span>)  <span class="co"># devtools::install_github(&quot;mbojan/lspline&quot;, build_vignettes=TRUE)</span></span>
<span id="cb85-11"><a href="trends.html#cb85-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;ggeffects&quot;</span>) <span class="co"># remotes::install_github(&quot;strengejacke/ggeffects&quot;)</span></span>
<span id="cb85-12"><a href="trends.html#cb85-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;margins&quot;</span>)</span>
<span id="cb85-13"><a href="trends.html#cb85-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;gtsummary&quot;</span>) <span class="co"># remotes::install_github(&quot;ddsjoberg/gtsummary&quot;)</span></span>
<span id="cb85-14"><a href="trends.html#cb85-14" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;sjPlot&quot;</span>) <span class="co"># plot marginal effects (&quot;plot_model&quot; function)</span></span></code></pre></div>
</div>
<div id="loading-data-into-the-r-environment" class="section level3 hasAnchor" number="5.2.2">
<h3><span class="header-section-number">5.2.2</span> Loading data into the R environment<a href="trends.html#loading-data-into-the-r-environment" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>There are two ways to load the data onto the R environment from AHRQ MEPS.</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="trends.html#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="co"># There are two ways to load data from AHRQ MEPS website:</span></span>
<span id="cb86-2"><a href="trends.html#cb86-2" aria-hidden="true" tabindex="-1"></a><span class="do">#### Method 1: Load data from AHRQ MEPS website</span></span>
<span id="cb86-3"><a href="trends.html#cb86-3" aria-hidden="true" tabindex="-1"></a>hc2021 <span class="ot">=</span> <span class="fu">read_MEPS</span>(<span class="at">file =</span> <span class="st">&quot;h233&quot;</span>)</span>
<span id="cb86-4"><a href="trends.html#cb86-4" aria-hidden="true" tabindex="-1"></a>hc2020 <span class="ot">=</span> <span class="fu">read_MEPS</span>(<span class="at">file =</span> <span class="st">&quot;h224&quot;</span>)</span>
<span id="cb86-5"><a href="trends.html#cb86-5" aria-hidden="true" tabindex="-1"></a>hc2019 <span class="ot">=</span> <span class="fu">read_MEPS</span>(<span class="at">file =</span> <span class="st">&quot;h216&quot;</span>)</span>
<span id="cb86-6"><a href="trends.html#cb86-6" aria-hidden="true" tabindex="-1"></a>hc2018 <span class="ot">=</span> <span class="fu">read_MEPS</span>(<span class="at">file =</span> <span class="st">&quot;h209&quot;</span>)</span>
<span id="cb86-7"><a href="trends.html#cb86-7" aria-hidden="true" tabindex="-1"></a>hc2017 <span class="ot">=</span> <span class="fu">read_MEPS</span>(<span class="at">file =</span> <span class="st">&quot;h201&quot;</span>)</span>
<span id="cb86-8"><a href="trends.html#cb86-8" aria-hidden="true" tabindex="-1"></a>hc2016 <span class="ot">=</span> <span class="fu">read_MEPS</span>(<span class="at">file =</span> <span class="st">&quot;h192&quot;</span>)</span>
<span id="cb86-9"><a href="trends.html#cb86-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-10"><a href="trends.html#cb86-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-11"><a href="trends.html#cb86-11" aria-hidden="true" tabindex="-1"></a><span class="do">#### Method 2: Load data from AHRQ MEPS website</span></span>
<span id="cb86-12"><a href="trends.html#cb86-12" aria-hidden="true" tabindex="-1"></a>hc2021 <span class="ot">=</span> <span class="fu">read_MEPS</span>(<span class="at">year =</span> <span class="dv">2021</span>, <span class="at">type =</span> <span class="st">&quot;FYC&quot;</span>)</span>
<span id="cb86-13"><a href="trends.html#cb86-13" aria-hidden="true" tabindex="-1"></a>hc2020 <span class="ot">=</span> <span class="fu">read_MEPS</span>(<span class="at">year =</span> <span class="dv">2020</span>, <span class="at">type =</span> <span class="st">&quot;FYC&quot;</span>)</span>
<span id="cb86-14"><a href="trends.html#cb86-14" aria-hidden="true" tabindex="-1"></a>hc2019 <span class="ot">=</span> <span class="fu">read_MEPS</span>(<span class="at">year =</span> <span class="dv">2019</span>, <span class="at">type =</span> <span class="st">&quot;FYC&quot;</span>)</span>
<span id="cb86-15"><a href="trends.html#cb86-15" aria-hidden="true" tabindex="-1"></a>hc2018 <span class="ot">=</span> <span class="fu">read_MEPS</span>(<span class="at">year =</span> <span class="dv">2018</span>, <span class="at">type =</span> <span class="st">&quot;FYC&quot;</span>)</span>
<span id="cb86-16"><a href="trends.html#cb86-16" aria-hidden="true" tabindex="-1"></a>hc2017 <span class="ot">=</span> <span class="fu">read_MEPS</span>(<span class="at">year =</span> <span class="dv">2017</span>, <span class="at">type =</span> <span class="st">&quot;FYC&quot;</span>)</span>
<span id="cb86-17"><a href="trends.html#cb86-17" aria-hidden="true" tabindex="-1"></a>hc2016 <span class="ot">=</span> <span class="fu">read_MEPS</span>(<span class="at">year =</span> <span class="dv">2016</span>, <span class="at">type =</span> <span class="st">&quot;FYC&quot;</span>)</span></code></pre></div>
<p>Once the data have been loaded onto R, we can made some edits. The first edit I make is ensure that all column or variable names are in lower case.</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="trends.html#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Change column names to lowercase</span></span>
<span id="cb87-2"><a href="trends.html#cb87-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(hc2021) <span class="ot">&lt;-</span> <span class="fu">tolower</span>(<span class="fu">names</span>(hc2021))</span>
<span id="cb87-3"><a href="trends.html#cb87-3" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(hc2020) <span class="ot">&lt;-</span> <span class="fu">tolower</span>(<span class="fu">names</span>(hc2020))</span>
<span id="cb87-4"><a href="trends.html#cb87-4" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(hc2019) <span class="ot">&lt;-</span> <span class="fu">tolower</span>(<span class="fu">names</span>(hc2019))</span>
<span id="cb87-5"><a href="trends.html#cb87-5" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(hc2018) <span class="ot">&lt;-</span> <span class="fu">tolower</span>(<span class="fu">names</span>(hc2018))</span>
<span id="cb87-6"><a href="trends.html#cb87-6" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(hc2017) <span class="ot">&lt;-</span> <span class="fu">tolower</span>(<span class="fu">names</span>(hc2017))</span>
<span id="cb87-7"><a href="trends.html#cb87-7" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(hc2016) <span class="ot">&lt;-</span> <span class="fu">tolower</span>(<span class="fu">names</span>(hc2016))</span></code></pre></div>
</div>
<div id="download-the-linkage-file" class="section level3 hasAnchor" number="5.2.3">
<h3><span class="header-section-number">5.2.3</span> Download the linkage file<a href="trends.html#download-the-linkage-file" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Next, we need to download the pooled linkage file. This has the updated primary sampling unit and strata for the individual respondents. This is an important file because when we pool MEPS data from different years, the primary sampling unit and strata will change. We will need to merge this with our pooled data eventually, which will be discussed later in the tutorial.</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="trends.html#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We need the linkage file with the appropriate stratum of the primary sampling strata (STRA9621) and primary sampling unit (PSU9621). (Note: Each year, the linkage file sampling unit name changes)</span></span>
<span id="cb88-2"><a href="trends.html#cb88-2" aria-hidden="true" tabindex="-1"></a>linkage <span class="ot">=</span> <span class="fu">read_MEPS</span>(<span class="at">type =</span> <span class="st">&quot;Pooled linkage&quot;</span>) </span>
<span id="cb88-3"><a href="trends.html#cb88-3" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(linkage) <span class="ot">&lt;-</span> <span class="fu">tolower</span>(<span class="fu">names</span>(linkage)) <span class="co"># change variable name to lower case</span></span></code></pre></div>
</div>
<div id="creating-the-pooled-data-file" class="section level3 hasAnchor" number="5.2.4">
<h3><span class="header-section-number">5.2.4</span> Creating the pooled data file<a href="trends.html#creating-the-pooled-data-file" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Now that we have the Full-Year Consolidated files from 2016 to 2021 and the pooled linkage files loaded onto the R environment, we can being to clean the data and merge them together.</p>
<p>We’ll start by keeping only those variables that will be needed for our analysis. These include the following variables:</p>
<ul>
<li><p><code>dupersid</code>: The unique identifier of the individual respondent</p></li>
<li><p><code>panel</code>: The panel when the individual entered the MEPS round</p></li>
<li><p><code>varstr</code>: The individual sampling strata</p></li>
<li><p><code>varpsu</code>: The individual primary sampling unit</p></li>
<li><p><code>sex</code>: The sex variable (1 = MALE, 2 = FEMALE)</p></li>
<li><p><code>totexp</code>: The total healthcare costs per individual per year (Note: This variable name was changed from the year-specific total expenditure (e.g., <code>totexp17f</code> to <code>totexp</code> because we are pooling from multiple years)</p></li>
<li><p><code>perwt</code>: The person weight for the individual in the sample (Note: This variable name was changed from the year-specific person weight (e.g., <code>perwt7f</code>) to <code>perwt</code> because we are pooling from multiple years)</p></li>
</ul>
<p>We also created an indicator variable <code>year</code> to reflect the year the Full-Year Consolidated file was captured.</p>
<p>When we merge all the data, we created a new variable <code>poolwt</code> where we divide the <code>perwt</code> by the number of years used in the pooled data (e.g., 6). This will generate a new individual person weight with the pooled data.</p>
<p>Note: For more instruction and information about pooling multiple years with MEPS data, please see the <a href="https://meps.ahrq.gov/data_stats/download_data/pufs/h36/h36u15doc.shtml">1996-2015 Pooled Linkage Variance Estimation File</a>. This document provides a good summary and documentation on creating a <code>poolwt</code> variable and using the pooled strata and primary sampling unit.</p>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="trends.html#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Select specific variables</span></span>
<span id="cb89-2"><a href="trends.html#cb89-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-3"><a href="trends.html#cb89-3" aria-hidden="true" tabindex="-1"></a><span class="do">### 2021</span></span>
<span id="cb89-4"><a href="trends.html#cb89-4" aria-hidden="true" tabindex="-1"></a>hc2021p <span class="ot">=</span> hc2021 <span class="sc">%&gt;%</span></span>
<span id="cb89-5"><a href="trends.html#cb89-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(</span>
<span id="cb89-6"><a href="trends.html#cb89-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">perwt =</span> perwt21f,</span>
<span id="cb89-7"><a href="trends.html#cb89-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">totexp =</span> totexp21) <span class="sc">%&gt;%</span></span>
<span id="cb89-8"><a href="trends.html#cb89-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb89-9"><a href="trends.html#cb89-9" aria-hidden="true" tabindex="-1"></a>    dupersid, </span>
<span id="cb89-10"><a href="trends.html#cb89-10" aria-hidden="true" tabindex="-1"></a>    panel, </span>
<span id="cb89-11"><a href="trends.html#cb89-11" aria-hidden="true" tabindex="-1"></a>    varstr, </span>
<span id="cb89-12"><a href="trends.html#cb89-12" aria-hidden="true" tabindex="-1"></a>    varpsu,</span>
<span id="cb89-13"><a href="trends.html#cb89-13" aria-hidden="true" tabindex="-1"></a>    perwt,</span>
<span id="cb89-14"><a href="trends.html#cb89-14" aria-hidden="true" tabindex="-1"></a>    sex,</span>
<span id="cb89-15"><a href="trends.html#cb89-15" aria-hidden="true" tabindex="-1"></a>    totexp)</span>
<span id="cb89-16"><a href="trends.html#cb89-16" aria-hidden="true" tabindex="-1"></a>hc2021p<span class="sc">$</span>year <span class="ot">&lt;-</span> <span class="dv">2021</span></span>
<span id="cb89-17"><a href="trends.html#cb89-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-18"><a href="trends.html#cb89-18" aria-hidden="true" tabindex="-1"></a><span class="do">### 2020</span></span>
<span id="cb89-19"><a href="trends.html#cb89-19" aria-hidden="true" tabindex="-1"></a>hc2020p <span class="ot">=</span> hc2020 <span class="sc">%&gt;%</span></span>
<span id="cb89-20"><a href="trends.html#cb89-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(</span>
<span id="cb89-21"><a href="trends.html#cb89-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">perwt =</span> perwt20f,</span>
<span id="cb89-22"><a href="trends.html#cb89-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">totexp =</span> totexp20) <span class="sc">%&gt;%</span></span>
<span id="cb89-23"><a href="trends.html#cb89-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb89-24"><a href="trends.html#cb89-24" aria-hidden="true" tabindex="-1"></a>    dupersid, </span>
<span id="cb89-25"><a href="trends.html#cb89-25" aria-hidden="true" tabindex="-1"></a>    panel, </span>
<span id="cb89-26"><a href="trends.html#cb89-26" aria-hidden="true" tabindex="-1"></a>    varstr, </span>
<span id="cb89-27"><a href="trends.html#cb89-27" aria-hidden="true" tabindex="-1"></a>    varpsu,</span>
<span id="cb89-28"><a href="trends.html#cb89-28" aria-hidden="true" tabindex="-1"></a>    perwt,</span>
<span id="cb89-29"><a href="trends.html#cb89-29" aria-hidden="true" tabindex="-1"></a>    sex,</span>
<span id="cb89-30"><a href="trends.html#cb89-30" aria-hidden="true" tabindex="-1"></a>    totexp)</span>
<span id="cb89-31"><a href="trends.html#cb89-31" aria-hidden="true" tabindex="-1"></a>hc2020p<span class="sc">$</span>year <span class="ot">&lt;-</span> <span class="dv">2020</span></span>
<span id="cb89-32"><a href="trends.html#cb89-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-33"><a href="trends.html#cb89-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-34"><a href="trends.html#cb89-34" aria-hidden="true" tabindex="-1"></a><span class="do">### 2019</span></span>
<span id="cb89-35"><a href="trends.html#cb89-35" aria-hidden="true" tabindex="-1"></a>hc2019p <span class="ot">=</span> hc2019 <span class="sc">%&gt;%</span></span>
<span id="cb89-36"><a href="trends.html#cb89-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(</span>
<span id="cb89-37"><a href="trends.html#cb89-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">perwt =</span> perwt19f,</span>
<span id="cb89-38"><a href="trends.html#cb89-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">totexp =</span> totexp19) <span class="sc">%&gt;%</span></span>
<span id="cb89-39"><a href="trends.html#cb89-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb89-40"><a href="trends.html#cb89-40" aria-hidden="true" tabindex="-1"></a>    dupersid, </span>
<span id="cb89-41"><a href="trends.html#cb89-41" aria-hidden="true" tabindex="-1"></a>    panel, </span>
<span id="cb89-42"><a href="trends.html#cb89-42" aria-hidden="true" tabindex="-1"></a>    varstr, </span>
<span id="cb89-43"><a href="trends.html#cb89-43" aria-hidden="true" tabindex="-1"></a>    varpsu,</span>
<span id="cb89-44"><a href="trends.html#cb89-44" aria-hidden="true" tabindex="-1"></a>    perwt,</span>
<span id="cb89-45"><a href="trends.html#cb89-45" aria-hidden="true" tabindex="-1"></a>    sex,</span>
<span id="cb89-46"><a href="trends.html#cb89-46" aria-hidden="true" tabindex="-1"></a>    totexp)</span>
<span id="cb89-47"><a href="trends.html#cb89-47" aria-hidden="true" tabindex="-1"></a>hc2019p<span class="sc">$</span>year <span class="ot">&lt;-</span> <span class="dv">2019</span></span>
<span id="cb89-48"><a href="trends.html#cb89-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-49"><a href="trends.html#cb89-49" aria-hidden="true" tabindex="-1"></a><span class="do">### 2018</span></span>
<span id="cb89-50"><a href="trends.html#cb89-50" aria-hidden="true" tabindex="-1"></a>hc2018p <span class="ot">=</span> hc2018 <span class="sc">%&gt;%</span></span>
<span id="cb89-51"><a href="trends.html#cb89-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(</span>
<span id="cb89-52"><a href="trends.html#cb89-52" aria-hidden="true" tabindex="-1"></a>    <span class="at">perwt =</span> perwt18f,</span>
<span id="cb89-53"><a href="trends.html#cb89-53" aria-hidden="true" tabindex="-1"></a>    <span class="at">totexp =</span> totexp18) <span class="sc">%&gt;%</span></span>
<span id="cb89-54"><a href="trends.html#cb89-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb89-55"><a href="trends.html#cb89-55" aria-hidden="true" tabindex="-1"></a>    dupersid, </span>
<span id="cb89-56"><a href="trends.html#cb89-56" aria-hidden="true" tabindex="-1"></a>    panel, </span>
<span id="cb89-57"><a href="trends.html#cb89-57" aria-hidden="true" tabindex="-1"></a>    varstr, </span>
<span id="cb89-58"><a href="trends.html#cb89-58" aria-hidden="true" tabindex="-1"></a>    varpsu,</span>
<span id="cb89-59"><a href="trends.html#cb89-59" aria-hidden="true" tabindex="-1"></a>    perwt,</span>
<span id="cb89-60"><a href="trends.html#cb89-60" aria-hidden="true" tabindex="-1"></a>    sex,</span>
<span id="cb89-61"><a href="trends.html#cb89-61" aria-hidden="true" tabindex="-1"></a>    totexp)</span>
<span id="cb89-62"><a href="trends.html#cb89-62" aria-hidden="true" tabindex="-1"></a>hc2018p<span class="sc">$</span>year <span class="ot">&lt;-</span> <span class="dv">2018</span></span>
<span id="cb89-63"><a href="trends.html#cb89-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-64"><a href="trends.html#cb89-64" aria-hidden="true" tabindex="-1"></a><span class="do">### 2017</span></span>
<span id="cb89-65"><a href="trends.html#cb89-65" aria-hidden="true" tabindex="-1"></a>hc2017p <span class="ot">=</span> hc2017 <span class="sc">%&gt;%</span></span>
<span id="cb89-66"><a href="trends.html#cb89-66" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(</span>
<span id="cb89-67"><a href="trends.html#cb89-67" aria-hidden="true" tabindex="-1"></a>    <span class="at">perwt =</span> perwt17f,</span>
<span id="cb89-68"><a href="trends.html#cb89-68" aria-hidden="true" tabindex="-1"></a>    <span class="at">totexp =</span> totexp17) <span class="sc">%&gt;%</span></span>
<span id="cb89-69"><a href="trends.html#cb89-69" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb89-70"><a href="trends.html#cb89-70" aria-hidden="true" tabindex="-1"></a>    dupersid, </span>
<span id="cb89-71"><a href="trends.html#cb89-71" aria-hidden="true" tabindex="-1"></a>    panel, </span>
<span id="cb89-72"><a href="trends.html#cb89-72" aria-hidden="true" tabindex="-1"></a>    varstr, </span>
<span id="cb89-73"><a href="trends.html#cb89-73" aria-hidden="true" tabindex="-1"></a>    varpsu,</span>
<span id="cb89-74"><a href="trends.html#cb89-74" aria-hidden="true" tabindex="-1"></a>    perwt,</span>
<span id="cb89-75"><a href="trends.html#cb89-75" aria-hidden="true" tabindex="-1"></a>    sex,</span>
<span id="cb89-76"><a href="trends.html#cb89-76" aria-hidden="true" tabindex="-1"></a>    totexp)</span>
<span id="cb89-77"><a href="trends.html#cb89-77" aria-hidden="true" tabindex="-1"></a>hc2017p<span class="sc">$</span>year <span class="ot">&lt;-</span> <span class="dv">2017</span></span>
<span id="cb89-78"><a href="trends.html#cb89-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-79"><a href="trends.html#cb89-79" aria-hidden="true" tabindex="-1"></a><span class="do">### 2016</span></span>
<span id="cb89-80"><a href="trends.html#cb89-80" aria-hidden="true" tabindex="-1"></a>hc2016p <span class="ot">=</span> hc2016 <span class="sc">%&gt;%</span></span>
<span id="cb89-81"><a href="trends.html#cb89-81" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(</span>
<span id="cb89-82"><a href="trends.html#cb89-82" aria-hidden="true" tabindex="-1"></a>    <span class="at">perwt =</span> perwt16f,</span>
<span id="cb89-83"><a href="trends.html#cb89-83" aria-hidden="true" tabindex="-1"></a>    <span class="at">totexp =</span> totexp16) <span class="sc">%&gt;%</span></span>
<span id="cb89-84"><a href="trends.html#cb89-84" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb89-85"><a href="trends.html#cb89-85" aria-hidden="true" tabindex="-1"></a>    dupersid, </span>
<span id="cb89-86"><a href="trends.html#cb89-86" aria-hidden="true" tabindex="-1"></a>    panel, </span>
<span id="cb89-87"><a href="trends.html#cb89-87" aria-hidden="true" tabindex="-1"></a>    varstr, </span>
<span id="cb89-88"><a href="trends.html#cb89-88" aria-hidden="true" tabindex="-1"></a>    varpsu,</span>
<span id="cb89-89"><a href="trends.html#cb89-89" aria-hidden="true" tabindex="-1"></a>    perwt,</span>
<span id="cb89-90"><a href="trends.html#cb89-90" aria-hidden="true" tabindex="-1"></a>    sex,</span>
<span id="cb89-91"><a href="trends.html#cb89-91" aria-hidden="true" tabindex="-1"></a>    totexp)</span>
<span id="cb89-92"><a href="trends.html#cb89-92" aria-hidden="true" tabindex="-1"></a>hc2016p<span class="sc">$</span>year <span class="ot">&lt;-</span> <span class="dv">2016</span></span>
<span id="cb89-93"><a href="trends.html#cb89-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-94"><a href="trends.html#cb89-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-95"><a href="trends.html#cb89-95" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge data and adjust the person weight by 6 years</span></span>
<span id="cb89-96"><a href="trends.html#cb89-96" aria-hidden="true" tabindex="-1"></a>pool_data <span class="ot">=</span> <span class="fu">bind_rows</span>(hc2021p, </span>
<span id="cb89-97"><a href="trends.html#cb89-97" aria-hidden="true" tabindex="-1"></a>                      hc2020p,</span>
<span id="cb89-98"><a href="trends.html#cb89-98" aria-hidden="true" tabindex="-1"></a>                      hc2019p,</span>
<span id="cb89-99"><a href="trends.html#cb89-99" aria-hidden="true" tabindex="-1"></a>                      hc2018p,</span>
<span id="cb89-100"><a href="trends.html#cb89-100" aria-hidden="true" tabindex="-1"></a>                      hc2017p,</span>
<span id="cb89-101"><a href="trends.html#cb89-101" aria-hidden="true" tabindex="-1"></a>                      hc2016p) <span class="sc">%&gt;%</span></span>
<span id="cb89-102"><a href="trends.html#cb89-102" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">poolwt =</span> perwt <span class="sc">/</span> <span class="dv">6</span>)</span></code></pre></div>
</div>
<div id="merging-with-pooled-survey-primary-sampling-strata-and-unit" class="section level3 hasAnchor" number="5.2.5">
<h3><span class="header-section-number">5.2.5</span> Merging with pooled survey primary sampling strata and unit<a href="trends.html#merging-with-pooled-survey-primary-sampling-strata-and-unit" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Next, we need to merge the pooled years file with the updated primary sampling strata and unit from the linkage file. The linkage file is updated every year. Since the latest Full-Year Consolidated Data file that we are using includes 2021, we are using the 2021 linkage file (<code>HC-229I</code>).</p>
<p>We first limit the linkage file to only include the following variables:</p>
<ul>
<li><p><code>dupersid</code>: The unique identifier for the individual respondent (Note: We will need this to merge the files later)</p></li>
<li><p><code>panel</code>: The panel when the individual entered the MEPS round (Note: We will need to use this to merge the files later)</p></li>
<li><p><code>stra9621</code>: The pooled sampling strata</p></li>
<li><p><code>psu9621</code>: The pooled primary sampling unit</p></li>
</ul>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="trends.html#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Reduce the linkage file to only include dupersid, panel, stra9621, psu9621</span></span>
<span id="cb90-2"><a href="trends.html#cb90-2" aria-hidden="true" tabindex="-1"></a>linkage_file <span class="ot">=</span> linkage <span class="sc">%&gt;%</span></span>
<span id="cb90-3"><a href="trends.html#cb90-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(dupersid, panel, stra9621, psu9621)</span>
<span id="cb90-4"><a href="trends.html#cb90-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-5"><a href="trends.html#cb90-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge link file with main data</span></span>
<span id="cb90-6"><a href="trends.html#cb90-6" aria-hidden="true" tabindex="-1"></a>pool_data_linked <span class="ot">=</span> <span class="fu">left_join</span>(pool_data,</span>
<span id="cb90-7"><a href="trends.html#cb90-7" aria-hidden="true" tabindex="-1"></a>                             linkage_file, </span>
<span id="cb90-8"><a href="trends.html#cb90-8" aria-hidden="true" tabindex="-1"></a>                             <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;dupersid&quot;</span>, <span class="st">&quot;panel&quot;</span>))</span></code></pre></div>
</div>
<div id="create-factor-variables" class="section level3 hasAnchor" number="5.2.6">
<h3><span class="header-section-number">5.2.6</span> Create factor variables<a href="trends.html#create-factor-variables" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We need to create factor variables so that we can evaluate the marginal effects. Disclaimer: I’m not sure if this is always necessary. However, I run into issues with the <code>margins</code> package when I estimated the average marginal effects in R. I get errors about the size of the dimension or vector, which indicates that the dimensions of the dataframe is not correct. I’m not sure why this error occurs, but I seem to have avoided it when I convert my categorical variables into factors. I’m not sure if this is a bug in the <code>margins</code> package or something I did with the terms in the regression model, but I’ll monitor and update this tutorial if there are any changes or discoveries. For now, we’ll convert our categorical variables into factors. Here, I also convert the variable <code>year</code> into a factor.</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="trends.html#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create factor variables:</span></span>
<span id="cb91-2"><a href="trends.html#cb91-2" aria-hidden="true" tabindex="-1"></a><span class="do">### MALE</span></span>
<span id="cb91-3"><a href="trends.html#cb91-3" aria-hidden="true" tabindex="-1"></a>pool_data_linked<span class="sc">$</span>male[pool_data_linked<span class="sc">$</span>sex <span class="sc">==</span> <span class="dv">1</span>] <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb91-4"><a href="trends.html#cb91-4" aria-hidden="true" tabindex="-1"></a>pool_data_linked<span class="sc">$</span>male[pool_data_linked<span class="sc">$</span>sex <span class="sc">==</span> <span class="dv">2</span>] <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb91-5"><a href="trends.html#cb91-5" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(pool_data_linked<span class="sc">$</span>male)</span></code></pre></div>
<pre><code>## 
##     0     1 
## 95023 86626</code></pre>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="trends.html#cb93-1" aria-hidden="true" tabindex="-1"></a>pool_data_linked<span class="sc">$</span>male <span class="ot">&lt;-</span> <span class="fu">factor</span>(pool_data_linked<span class="sc">$</span>male, <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb93-2"><a href="trends.html#cb93-2" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(pool_data_linked<span class="sc">$</span>male)</span></code></pre></div>
<pre><code>## [1] &quot;factor&quot;</code></pre>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="trends.html#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(pool_data_linked<span class="sc">$</span>male)</span></code></pre></div>
<pre><code>## [1] &quot;0&quot; &quot;1&quot;</code></pre>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="trends.html#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="do">### YEAR</span></span>
<span id="cb97-2"><a href="trends.html#cb97-2" aria-hidden="true" tabindex="-1"></a>pool_data_linked<span class="sc">$</span>year <span class="ot">&lt;-</span> <span class="fu">factor</span>(pool_data_linked<span class="sc">$</span>year, <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">2016</span>, <span class="dv">2017</span>, <span class="dv">2018</span>, <span class="dv">2019</span>, <span class="dv">2020</span>, <span class="dv">2021</span>))</span>
<span id="cb97-3"><a href="trends.html#cb97-3" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(pool_data_linked<span class="sc">$</span>year)</span></code></pre></div>
<pre><code>## [1] &quot;factor&quot;</code></pre>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="trends.html#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(pool_data_linked<span class="sc">$</span>year)</span></code></pre></div>
<pre><code>## [1] &quot;2016&quot; &quot;2017&quot; &quot;2018&quot; &quot;2019&quot; &quot;2020&quot; &quot;2021&quot;</code></pre>
</div>
<div id="set-the-survey-options" class="section level3 hasAnchor" number="5.2.7">
<h3><span class="header-section-number">5.2.7</span> Set the survey options<a href="trends.html#set-the-survey-options" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Next, we set the survey options so that we can estimate the survey-weighted values for our population.</p>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="trends.html#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="do">################################# SURVEY ################################# </span></span>
<span id="cb101-2"><a href="trends.html#cb101-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-3"><a href="trends.html#cb101-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the survey options</span></span>
<span id="cb101-4"><a href="trends.html#cb101-4" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">survey.lonely.psu =</span> <span class="st">&quot;adjust&quot;</span>)</span>
<span id="cb101-5"><a href="trends.html#cb101-5" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">survey.adjust.domain.lonely =</span> <span class="cn">TRUE</span>)</span>
<span id="cb101-6"><a href="trends.html#cb101-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-7"><a href="trends.html#cb101-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-8"><a href="trends.html#cb101-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the survey design</span></span>
<span id="cb101-9"><a href="trends.html#cb101-9" aria-hidden="true" tabindex="-1"></a>survey_design <span class="ot">=</span> <span class="fu">svydesign</span>(</span>
<span id="cb101-10"><a href="trends.html#cb101-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">id =</span> <span class="sc">~</span>psu9621,</span>
<span id="cb101-11"><a href="trends.html#cb101-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">strata =</span> <span class="sc">~</span>stra9621,</span>
<span id="cb101-12"><a href="trends.html#cb101-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">weights =</span> <span class="sc">~</span>poolwt,</span>
<span id="cb101-13"><a href="trends.html#cb101-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> pool_data_linked,</span>
<span id="cb101-14"><a href="trends.html#cb101-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">nest =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
</div>
<div id="trend-analysis---plot-the-total-healthcare-costs-by-sex-across-time" class="section level3 hasAnchor" number="5.2.8">
<h3><span class="header-section-number">5.2.8</span> Trend analysis - Plot the total healthcare costs by sex across time<a href="trends.html#trend-analysis---plot-the-total-healthcare-costs-by-sex-across-time" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We can look at the total healthcare costs <code>totexp</code> by <code>sex</code> across time <code>year</code> with the <code>ggsurvey</code> function, which is part of the <code>questionr</code> package.</p>
<p>Visualizing the trends, females have a higher average total healthcare costs compared to males, and these are increasing across time. (Note: This trend was generated with the survey weights.)</p>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb102-1"><a href="trends.html#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="do">################################ TREND ANALYSIS ################################ </span></span>
<span id="cb102-2"><a href="trends.html#cb102-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-3"><a href="trends.html#cb102-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot total expenditures over time (Load the &quot;questionr&quot; package to use &quot;ggsurvey&quot;)</span></span>
<span id="cb102-4"><a href="trends.html#cb102-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsurvey</span>(survey_design) <span class="sc">+</span></span>
<span id="cb102-5"><a href="trends.html#cb102-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> totexp, <span class="at">group =</span> <span class="fu">factor</span>(male), <span class="at">color =</span> <span class="fu">factor</span>(male)) <span class="sc">+</span></span>
<span id="cb102-6"><a href="trends.html#cb102-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun =</span> <span class="st">&quot;mean&quot;</span>, <span class="at">geom =</span> <span class="st">&quot;point&quot;</span>, <span class="at">size =</span> <span class="dv">5</span>) <span class="sc">+</span> </span>
<span id="cb102-7"><a href="trends.html#cb102-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun =</span> <span class="st">&quot;mean&quot;</span>, <span class="at">geom =</span> <span class="st">&quot;line&quot;</span>, <span class="at">size =</span> <span class="dv">1</span>) </span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-70-1.png" width="672" /></p>
</div>
<div id="regression-model" class="section level3 hasAnchor" number="5.2.9">
<h3><span class="header-section-number">5.2.9</span> Regression model<a href="trends.html#regression-model" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We construct a linear regression model using the <code>svyglm</code> function in R. We included the terms <code>sex</code> and <code>year</code>, and we included an interaction term <code>sex:year</code>. This interaction term provides the estimates that describe the differences in the healthcare total costs between males and females when the years changes.</p>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb103-1"><a href="trends.html#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Survey-weight GLM model with interaction term</span></span>
<span id="cb103-2"><a href="trends.html#cb103-2" aria-hidden="true" tabindex="-1"></a>survey_model <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(totexp <span class="sc">~</span> <span class="fu">factor</span>(male) <span class="sc">+</span> <span class="fu">factor</span>(year) <span class="sc">+</span> <span class="fu">factor</span>(male)<span class="sc">:</span><span class="fu">factor</span>(year), survey_design)</span></code></pre></div>
<p>We can view the estimates with their corresponding 95% confidence intervals (CIs).</p>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb104-1"><a href="trends.html#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Summary table with 95% CI</span></span>
<span id="cb104-2"><a href="trends.html#cb104-2" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(</span>
<span id="cb104-3"><a href="trends.html#cb104-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind</span>(</span>
<span id="cb104-4"><a href="trends.html#cb104-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summary</span>(survey_model, <span class="at">df.resid =</span> <span class="fu">degf</span>(survey_model<span class="sc">$</span>survey.design))<span class="sc">$</span>coef, </span>
<span id="cb104-5"><a href="trends.html#cb104-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">confint</span>(survey_model, <span class="at">df       =</span> <span class="fu">degf</span>(survey_model<span class="sc">$</span>survey.design))</span>
<span id="cb104-6"><a href="trends.html#cb104-6" aria-hidden="true" tabindex="-1"></a>  ), <span class="dv">4</span>)</span></code></pre></div>
<pre><code>##                                  Estimate Std. Error t value Pr(&gt;|t|)
## (Intercept)                     5632.6497   153.3156 36.7389   0.0000
## factor(male)1                  -1280.8517   183.1791 -6.9923   0.0000
## factor(year)2017                 164.5324   200.4297  0.8209   0.4121
## factor(year)2018                 981.6884   231.2365  4.2454   0.0000
## factor(year)2019                1103.9018   220.8327  4.9988   0.0000
## factor(year)2020                1022.3480   255.6661  3.9988   0.0001
## factor(year)2021                1964.5098   279.9440  7.0175   0.0000
## factor(male)1:factor(year)2017   276.5807   250.6373  1.1035   0.2704
## factor(male)1:factor(year)2018   154.8177   277.8425  0.5572   0.5776
## factor(male)1:factor(year)2019   291.3151   276.8655  1.0522   0.2932
## factor(male)1:factor(year)2020   487.1318   353.7995  1.3769   0.1692
## factor(male)1:factor(year)2021   -65.6524   403.7881 -0.1626   0.8709
##                                     2.5 %    97.5 %
## (Intercept)                     5331.3906 5933.9088
## factor(male)1                  -1640.7914 -920.9121
## factor(year)2017                -229.3041  558.3688
## factor(year)2018                 527.3179 1436.0589
## factor(year)2019                 669.9743 1537.8294
## factor(year)2020                 519.9744 1524.7217
## factor(year)2021                1414.4311 2514.5886
## factor(male)1:factor(year)2017  -215.9115  769.0730
## factor(male)1:factor(year)2018  -391.1317  700.7671
## factor(male)1:factor(year)2019  -252.7145  835.3448
## factor(male)1:factor(year)2020  -208.0701 1182.3338
## factor(male)1:factor(year)2021  -859.0800  727.7751</code></pre>
<p>A nicer way of presenting the regression model output is with the <code>tbl_regression</code> function from the <code>gtsummary</code> package.</p>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb106-1"><a href="trends.html#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Use gtsummary to generate a clean summary table.</span></span>
<span id="cb106-2"><a href="trends.html#cb106-2" aria-hidden="true" tabindex="-1"></a>survey_model <span class="sc">%&gt;%</span></span>
<span id="cb106-3"><a href="trends.html#cb106-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tbl_regression</span>(<span class="at">intercept =</span> <span class="cn">FALSE</span>, </span>
<span id="cb106-4"><a href="trends.html#cb106-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">estimate_fun =</span> <span class="cf">function</span>(x) <span class="fu">style_sigfig</span>(x, <span class="at">digits =</span> <span class="dv">3</span>),</span>
<span id="cb106-5"><a href="trends.html#cb106-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">pvalue_fun =</span> <span class="cf">function</span>(x) <span class="fu">style_sigfig</span>(x, <span class="at">digits =</span> <span class="dv">3</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb106-6"><a href="trends.html#cb106-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">modify_caption</span>(<span class="st">&quot;Survey-weighted linear regression&quot;</span>)</span></code></pre></div>
<div id="qudzwrscpe" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#qudzwrscpe table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#qudzwrscpe thead, #qudzwrscpe tbody, #qudzwrscpe tfoot, #qudzwrscpe tr, #qudzwrscpe td, #qudzwrscpe th {
  border-style: none;
}

#qudzwrscpe p {
  margin: 0;
  padding: 0;
}

#qudzwrscpe .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#qudzwrscpe .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#qudzwrscpe .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#qudzwrscpe .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#qudzwrscpe .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#qudzwrscpe .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#qudzwrscpe .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#qudzwrscpe .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#qudzwrscpe .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#qudzwrscpe .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#qudzwrscpe .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#qudzwrscpe .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#qudzwrscpe .gt_spanner_row {
  border-bottom-style: hidden;
}

#qudzwrscpe .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#qudzwrscpe .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#qudzwrscpe .gt_from_md > :first-child {
  margin-top: 0;
}

#qudzwrscpe .gt_from_md > :last-child {
  margin-bottom: 0;
}

#qudzwrscpe .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#qudzwrscpe .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#qudzwrscpe .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#qudzwrscpe .gt_row_group_first td {
  border-top-width: 2px;
}

#qudzwrscpe .gt_row_group_first th {
  border-top-width: 2px;
}

#qudzwrscpe .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#qudzwrscpe .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#qudzwrscpe .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#qudzwrscpe .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#qudzwrscpe .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#qudzwrscpe .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#qudzwrscpe .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#qudzwrscpe .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#qudzwrscpe .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#qudzwrscpe .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#qudzwrscpe .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#qudzwrscpe .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#qudzwrscpe .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#qudzwrscpe .gt_left {
  text-align: left;
}

#qudzwrscpe .gt_center {
  text-align: center;
}

#qudzwrscpe .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#qudzwrscpe .gt_font_normal {
  font-weight: normal;
}

#qudzwrscpe .gt_font_bold {
  font-weight: bold;
}

#qudzwrscpe .gt_font_italic {
  font-style: italic;
}

#qudzwrscpe .gt_super {
  font-size: 65%;
}

#qudzwrscpe .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#qudzwrscpe .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#qudzwrscpe .gt_indent_1 {
  text-indent: 5px;
}

#qudzwrscpe .gt_indent_2 {
  text-indent: 10px;
}

#qudzwrscpe .gt_indent_3 {
  text-indent: 15px;
}

#qudzwrscpe .gt_indent_4 {
  text-indent: 20px;
}

#qudzwrscpe .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
  <caption><span id="tab:unnamed-chunk-73">Table 5.1: </span>Survey-weighted linear regression</caption>
  <thead>
    
    <tr class="gt_col_headings">
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="&lt;strong&gt;Characteristic&lt;/strong&gt;"><strong>Characteristic</strong></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="&lt;strong&gt;Beta&lt;/strong&gt;"><strong>Beta</strong></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="&lt;strong&gt;95% CI&lt;/strong&gt;&lt;span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;&quot;&gt;&lt;sup&gt;1&lt;/sup&gt;&lt;/span&gt;"><strong>95% CI</strong><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>1</sup></span></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="&lt;strong&gt;p-value&lt;/strong&gt;"><strong>p-value</strong></th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td headers="label" class="gt_row gt_left">factor(male)</td>
<td headers="estimate" class="gt_row gt_center"><br /></td>
<td headers="ci" class="gt_row gt_center"><br /></td>
<td headers="p.value" class="gt_row gt_center"><br /></td></tr>
    <tr><td headers="label" class="gt_row gt_left">    0</td>
<td headers="estimate" class="gt_row gt_center">—</td>
<td headers="ci" class="gt_row gt_center">—</td>
<td headers="p.value" class="gt_row gt_center"><br /></td></tr>
    <tr><td headers="label" class="gt_row gt_left">    1</td>
<td headers="estimate" class="gt_row gt_center">-1,281</td>
<td headers="ci" class="gt_row gt_center">-1,641, -921</td>
<td headers="p.value" class="gt_row gt_center">0.000</td></tr>
    <tr><td headers="label" class="gt_row gt_left">factor(year)</td>
<td headers="estimate" class="gt_row gt_center"><br /></td>
<td headers="ci" class="gt_row gt_center"><br /></td>
<td headers="p.value" class="gt_row gt_center"><br /></td></tr>
    <tr><td headers="label" class="gt_row gt_left">    2016</td>
<td headers="estimate" class="gt_row gt_center">—</td>
<td headers="ci" class="gt_row gt_center">—</td>
<td headers="p.value" class="gt_row gt_center"><br /></td></tr>
    <tr><td headers="label" class="gt_row gt_left">    2017</td>
<td headers="estimate" class="gt_row gt_center">165</td>
<td headers="ci" class="gt_row gt_center">-229, 558</td>
<td headers="p.value" class="gt_row gt_center">0.412</td></tr>
    <tr><td headers="label" class="gt_row gt_left">    2018</td>
<td headers="estimate" class="gt_row gt_center">982</td>
<td headers="ci" class="gt_row gt_center">527, 1,436</td>
<td headers="p.value" class="gt_row gt_center">0.000</td></tr>
    <tr><td headers="label" class="gt_row gt_left">    2019</td>
<td headers="estimate" class="gt_row gt_center">1,104</td>
<td headers="ci" class="gt_row gt_center">670, 1,538</td>
<td headers="p.value" class="gt_row gt_center">0.000</td></tr>
    <tr><td headers="label" class="gt_row gt_left">    2020</td>
<td headers="estimate" class="gt_row gt_center">1,022</td>
<td headers="ci" class="gt_row gt_center">520, 1,525</td>
<td headers="p.value" class="gt_row gt_center">0.000</td></tr>
    <tr><td headers="label" class="gt_row gt_left">    2021</td>
<td headers="estimate" class="gt_row gt_center">1,965</td>
<td headers="ci" class="gt_row gt_center">1,414, 2,515</td>
<td headers="p.value" class="gt_row gt_center">0.000</td></tr>
    <tr><td headers="label" class="gt_row gt_left">factor(male) * factor(year)</td>
<td headers="estimate" class="gt_row gt_center"><br /></td>
<td headers="ci" class="gt_row gt_center"><br /></td>
<td headers="p.value" class="gt_row gt_center"><br /></td></tr>
    <tr><td headers="label" class="gt_row gt_left">    1 * 2017</td>
<td headers="estimate" class="gt_row gt_center">277</td>
<td headers="ci" class="gt_row gt_center">-216, 769</td>
<td headers="p.value" class="gt_row gt_center">0.270</td></tr>
    <tr><td headers="label" class="gt_row gt_left">    1 * 2018</td>
<td headers="estimate" class="gt_row gt_center">155</td>
<td headers="ci" class="gt_row gt_center">-391, 701</td>
<td headers="p.value" class="gt_row gt_center">0.578</td></tr>
    <tr><td headers="label" class="gt_row gt_left">    1 * 2019</td>
<td headers="estimate" class="gt_row gt_center">291</td>
<td headers="ci" class="gt_row gt_center">-253, 835</td>
<td headers="p.value" class="gt_row gt_center">0.293</td></tr>
    <tr><td headers="label" class="gt_row gt_left">    1 * 2020</td>
<td headers="estimate" class="gt_row gt_center">487</td>
<td headers="ci" class="gt_row gt_center">-208, 1,182</td>
<td headers="p.value" class="gt_row gt_center">0.169</td></tr>
    <tr><td headers="label" class="gt_row gt_left">    1 * 2021</td>
<td headers="estimate" class="gt_row gt_center">-65.7</td>
<td headers="ci" class="gt_row gt_center">-859, 728</td>
<td headers="p.value" class="gt_row gt_center">0.871</td></tr>
  </tbody>
  
  <tfoot class="gt_footnotes">
    <tr>
      <td class="gt_footnote" colspan="4"><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>1</sup></span> CI = Confidence Interval</td>
    </tr>
  </tfoot>
</table>
</div>
<p>From these findings, we can make several interpretations.</p>
<p>The most important estimates are the interaction terms. These provide the estimation or the change in healthcare total costs between males and females due to an increase in the year. For instance, the interaction term <code>factor(male)1:factor(year)2017</code> is interpreted as the average difference in the change in total healthcare costs between males and females when the year increased from 2016 to 2017. This difference in the changes in total healthcare costs between males and females is $276.58 (95% CI: -$215.91, $769.07), which was not statistically significant.</p>
</div>
<div id="average-marginal-effects-between-males-and-females-at-each-year" class="section level3 hasAnchor" number="5.2.10">
<h3><span class="header-section-number">5.2.10</span> Average marginal effects between males and females at each year<a href="trends.html#average-marginal-effects-between-males-and-females-at-each-year" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We can generate the average marginal effects or the differences in total healthcare costs between males and females at each year using the <code>margins</code> function.</p>
<p>For instance, the difference in total healthcare costs between males and females in 2019 was -$990; 95% CI: -$1,396, -$583, which was statistically significant. This means that males had lower average total healthcare costs compared to females in 2019.</p>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb107-1"><a href="trends.html#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Equivalent to Stata&#39;s margin, dydx(year), at(male = 0:1)</span></span>
<span id="cb107-2"><a href="trends.html#cb107-2" aria-hidden="true" tabindex="-1"></a>margins1 <span class="ot">&lt;-</span> <span class="fu">margins</span>(survey_model, <span class="at">type =</span> <span class="st">&quot;response&quot;</span>, <span class="at">design =</span> survey_design, <span class="at">at =</span> <span class="fu">list</span>(<span class="at">year =</span> <span class="fu">c</span>(<span class="dv">2016</span>, <span class="dv">2017</span>, <span class="dv">2018</span>, <span class="dv">2019</span>, <span class="dv">2020</span>, <span class="dv">2021</span>)), <span class="at">variables =</span> <span class="st">&quot;male&quot;</span>)</span>
<span id="cb107-3"><a href="trends.html#cb107-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(margins1)</span></code></pre></div>
<pre><code>##  factor      year        AME       SE       z      p      lower     upper
##   male1 2016.0000 -1280.8517 183.1789 -6.9924 0.0000 -1639.8757 -921.8278
##   male1 2017.0000 -1004.2710 188.0103 -5.3416 0.0000 -1372.7644 -635.7776
##   male1 2018.0000 -1126.0341 208.9060 -5.3901 0.0000 -1535.4823 -716.5859
##   male1 2019.0000  -989.5366 207.6048 -4.7664 0.0000 -1396.4346 -582.6386
##   male1 2020.0000  -793.7199 302.6867 -2.6222 0.0087 -1386.9749 -200.4649
##   male1 2021.0000 -1346.5042 359.8470 -3.7419 0.0002 -2051.7913 -641.2170</code></pre>
</div>
<div id="average-marginal-effects-between-years-for-males-and-females" class="section level3 hasAnchor" number="5.2.11">
<h3><span class="header-section-number">5.2.11</span> Average marginal effects between years for males and females<a href="trends.html#average-marginal-effects-between-years-for-males-and-females" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Alternatively, we can estimate the average marginal effects or the changes in total healthcare costs between years for males and females.</p>
<p>For instance, in 2021, males had an average total healthcare cost of $1965; 95% CI: $1,416, $2,513, and females had an average total healthcare cost of $1,899; 95% CI: $1277, $2521.</p>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb109-1"><a href="trends.html#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Equivalent to Stata&#39;s margin, dydx(year), at(male = 0:1)</span></span>
<span id="cb109-2"><a href="trends.html#cb109-2" aria-hidden="true" tabindex="-1"></a>margins2 <span class="ot">&lt;-</span> <span class="fu">margins</span>(survey_model, <span class="at">type =</span> <span class="st">&quot;response&quot;</span>, <span class="at">design =</span> survey_design, <span class="at">at =</span> <span class="fu">list</span>(<span class="at">male =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>), <span class="at">variables =</span> <span class="st">&quot;year&quot;</span>)</span>
<span id="cb109-3"><a href="trends.html#cb109-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(margins2)</span></code></pre></div>
<pre><code>##    factor   male       AME       SE      z      p     lower     upper
##  year2017 0.0000  164.5324 200.4294 0.8209 0.4117 -228.3021  557.3669
##  year2017 1.0000  441.1131 190.2654 2.3184 0.0204   68.1998  814.0265
##  year2018 0.0000  981.6884 231.2367 4.2454 0.0000  528.4728 1434.9040
##  year2018 1.0000 1136.5061 225.5083 5.0398 0.0000  694.5180 1578.4942
##  year2019 0.0000 1103.9018 220.8324 4.9988 0.0000  671.0782 1536.7254
##  year2019 1.0000 1395.2170 213.9435 6.5214 0.0000  975.8953 1814.5386
##  year2020 0.0000 1022.3480 255.6657 3.9988 0.0001  521.2525 1523.4436
##  year2020 1.0000 1509.4799 283.0927 5.3321 0.0000  954.6284 2064.3314
##  year2021 0.0000 1964.5098 279.9436 7.0175 0.0000 1415.8305 2513.1891
##  year2021 1.0000 1898.8574 317.1989 5.9863 0.0000 1277.1590 2520.5558</code></pre>
</div>
<div id="plot-the-average-marginal-effects" class="section level3 hasAnchor" number="5.2.12">
<h3><span class="header-section-number">5.2.12</span> Plot the average marginal effects<a href="trends.html#plot-the-average-marginal-effects" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We can plot the average marginal effects between males and females across time <code>year</code>. We can visualize the average total healthcare costs for males and females at each year from 2016 to 2021.</p>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb111-1"><a href="trends.html#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the marginal effects</span></span>
<span id="cb111-2"><a href="trends.html#cb111-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_model</span>(survey_model, <span class="at">type =</span> <span class="st">&quot;pred&quot;</span>, <span class="at">terms =</span> <span class="fu">c</span>(<span class="st">&quot;year&quot;</span>, <span class="st">&quot;male&quot;</span>), <span class="at">dot.size =</span> <span class="fl">4.</span>, <span class="at">line.size =</span> <span class="dv">1</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-76-1.png" width="672" /></p>
<p>We could also plot the average marginal effects using <code>ggplot2</code> with the <code>ggpredict</code> package.</p>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb112-1"><a href="trends.html#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the predicted values</span></span>
<span id="cb112-2"><a href="trends.html#cb112-2" aria-hidden="true" tabindex="-1"></a>fit.dataframe <span class="ot">&lt;-</span> <span class="fu">ggpredict</span>(survey_model, <span class="at">terms =</span> <span class="fu">c</span>(<span class="st">&quot;year&quot;</span>, <span class="st">&quot;male&quot;</span>), <span class="at">design =</span> survey_design)</span>
<span id="cb112-3"><a href="trends.html#cb112-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(fit.dataframe, <span class="fu">aes</span>(x, predicted, <span class="at">colour =</span> group)) <span class="sc">+</span></span>
<span id="cb112-4"><a href="trends.html#cb112-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb112-5"><a href="trends.html#cb112-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">5</span>) <span class="sc">+</span> </span>
<span id="cb112-6"><a href="trends.html#cb112-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb112-7"><a href="trends.html#cb112-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Year&quot;</span>,</span>
<span id="cb112-8"><a href="trends.html#cb112-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Total healthcare costs&quot;</span>,</span>
<span id="cb112-9"><a href="trends.html#cb112-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">colour =</span> <span class="fu">get_legend_title</span>(fit.dataframe)</span>
<span id="cb112-10"><a href="trends.html#cb112-10" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-77-1.png" width="672" /></p>
<p>There are a few important things to plot with these figures.</p>
<p>In the first figure below, we see that the slopes or change in average total healthcare costs across the years are displayed for the males and females. The output from the <code>margins</code> function provides us with the within group change in total healthcare costs for males and females across time. For instance, the change from 2016 to 2017 for females (which is also called the slope between 2016 and 2017) was $165. For males, their slope was $441.</p>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-78"></span>
<img src="Figure%205_2.png" alt="Average marginal effects or the Slopes of males and females." width="100%" />
<p class="caption">
Figure 5.1: Average marginal effects or the Slopes of males and females.
</p>
</div>
<p>In the second figure, we can use the output from the <code>margins1</code> object to estimate the difference in total healthcare costs at each year between males and females. For instance, we can visualize the difference in total healthcare costs at 2019 between males and females is -$990.</p>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-79"></span>
<img src="Figure%205_3.png" alt="Differences in total healthcare costs between males and females in 2019." width="100%" />
<p class="caption">
Figure 5.2: Differences in total healthcare costs between males and females in 2019.
</p>
</div>
<p>The last figure is the most important. This visualizes the interaction term results. We are mostly interested in the interaction terms for trend analysis. The interaction terms tell us the differences in the total healthcare costs between males and females as the year changes (2016 to 2018).</p>
<p>For instance, the slope change for females between 2018 and 2016 was approximately $981. The slope change for males between 2018 and 2016 was $1136. The difference between these two slope changes for males and females is $1136 - $981 = $155. This is our difference in the changes estimation, or we can state that this is the differences in total healthcare costs between males and females as the year changed from 2016 to 2018. But, this was not statistically significant since the 95% CI includes zero (95% CI: -$391, $701).</p>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-80"></span>
<img src="Figure%205_4.png" alt="Interaction terms - difference in the changes between males and females when year increased from 2016 to 2018." width="100%" />
<p class="caption">
Figure 5.3: Interaction terms - difference in the changes between males and females when year increased from 2016 to 2018.
</p>
</div>
</div>
</div>
<div id="conclusions-4" class="section level2 hasAnchor" number="5.3">
<h2><span class="header-section-number">5.3</span> Conclusions<a href="trends.html#conclusions-4" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Trend analysis can be performed using linear models. The ease of interpretation and simple execution makes this ideal for most stakeholders. Moreover, the <code>svyglm</code> function allows us to incorporate the survey weights from the complex survey design of MEPS to generate standard errors that were representative of the general U.S. population. Although the <code>margins</code> package is helpful in estimating the average marginal effects, there are other alternatives such as the <a href="https://github.com/vincentarelbundock/marginaleffects"><code>marginaleffects</code> package</a>.</p>
<p>Additionally, more complex models exist that account for autoregressive correlations and more precise estimations of the variance. However, they are harder to implement with complex survey designs. Unfortunately, I have not been able to figure out how to perform some of these more complex longitudinal data analysis with alternative models (e.g., linear mixed effects models) that incorporate the survey weights. For these scenarios, I prefer to use <code>Stata</code>, which makes it convenient to apply survey weights in more complex models. Perhaps, I’ll create some tutorials using <code>Stata</code> for these more complex longitudinal models in the future.</p>
</div>
<div id="acknowledgements-4" class="section level2 hasAnchor" number="5.4">
<h2><span class="header-section-number">5.4</span> Acknowledgements<a href="trends.html#acknowledgements-4" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>I am grateful to the author of the <code>margins</code> package, Thomas J. Leeper. You can find his <code>margins</code> package on his <a href="https://github.com/leeper/margins"><code>GitHub site</code></a>.</p>
<p>Additionally, the <code>marginaleffects</code> package by Vincent Arel-Bundock has helped me to compare some of <code>R</code>’s marginal effects commands with <code>Stata</code>. You can find his GitHub site <a href="https://github.com/vincentarelbundock/marginaleffects">here</a>.</p>
</div>
<div id="work-in-progress-1" class="section level2 hasAnchor" number="5.5">
<h2><span class="header-section-number">5.5</span> Work in progress<a href="trends.html#work-in-progress-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This is a work in progress so expect some updates in the future.</p>
</div>
<div id="disclaimers-1" class="section level2 hasAnchor" number="5.6">
<h2><span class="header-section-number">5.6</span> Disclaimers<a href="trends.html#disclaimers-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Any errors or mistakes are those of the author.</p>
<p>This is only for educational purposes.</p>
<p>This was built under R version 4.2.2 “Innocent and Trusting”</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="clnk.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="itsa.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": false
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/USERNAME/REPO/edit/BRANCH/05-trends.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf", "_main.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
